# Development Dockerfile for Frontend
FROM node:20-alpine

# Set npm cache directory and install system dependencies
ENV NPM_CONFIG_CACHE=/tmp/.npm
RUN apk add --no-cache libc6-compat

# Create non-root user early
RUN addgroup -g 1001 -S nodejs && adduser -S nuxt -u 1001 -G nodejs

# Set working directory and change ownership
WORKDIR /app
RUN chown nuxt:nodejs /app

# Switch to non-root user for all subsequent operations
USER nuxt

# Copy package files with correct ownership
COPY --chown=nuxt:nodejs package*.json ./

# Install dependencies with clean cache and production optimizations
RUN npm ci --only=production=false --no-audit --no-fund && npm cache clean --force

# Source code will be mounted as volume in docker-compose.override.yml
# No need to copy source code for development

# Set environment variables
ENV NODE_ENV=development
ENV PORT=3000
ENV HOST=0.0.0.0

# Expose port
EXPOSE 3000

# Start in development mode
CMD ["npm", "run", "dev"]